# 会话管理

## 1. 功能概述

管理 Claude Code 执行的历史会话，提供项目列表、会话列表和消息历史查询功能，让用户可以回顾之前的任务执行记录。

## 2. 用户场景

| 场景 | 描述 |
|------|------|
| 查看项目列表 | 用户想了解有哪些项目使用过 Claude Code |
| 查看项目会话 | 用户想查看某个项目的所有历史会话 |
| 查看会话详情 | 用户想查看特定会话的完整对话内容 |
| 回顾任务 | 用户想查看之前执行任务的具体过程和结果 |

## 3. 功能列表

### 3.1 项目列表

- 获取所有使用过 Claude Code 的项目
- 显示每个项目的基本信息：
  - 项目编码名称
  - 项目路径
  - 会话数量
  - 使用的工具列表

### 3.2 会话列表

- 获取指定项目的所有历史会话
- 显示会话基本信息：
  - 会话 ID
  - 会话标题（首条用户消息）
  - 创建时间
  - 消息数量
  - 会话数据大小

### 3.3 消息历史

- 获取会话的完整对话历史
- 支持多种内容块类型：
  - text：文本内容
  - thinking：思考过程
  - tool_use：工具调用
  - tool_result：工具结果
  - image：图片内容
- 显示消息元数据：
  - 角色（user/assistant）
  - 时间戳
  - UUID
  - 停止原因（assistant 消息）
  - token 使用量（assistant 消息）

## 4. 验收标准

### 4.1 功能验收

- [ ] 项目列表 API 返回所有项目信息
- [ ] 项目列表包含正确的会话数量和工具汇总
- [ ] 会话列表 API 按项目返回历史会话
- [ ] 消息历史 API 返回完整对话内容
- [ ] 支持多种内容块类型解析

### 4.2 数据格式验收

- [ ] 项目名称编码正确（路径特殊字符转换）
- [ ] 会话时间戳格式正确
- [ ] token 使用量统计准确

### 4.3 UI 验收

- [ ] 项目列表页面正确显示
- [ ] 会话列表页面正确显示
- [ ] 消息历史页面正确显示
- [ ] 内容块类型区分清晰（文本、工具调用、工具结果）
