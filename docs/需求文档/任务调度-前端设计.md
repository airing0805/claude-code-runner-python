# 任务调度 - 前端设计

## 1. 概述

任务调度功能提供 24/7 自动化任务执行能力，支持立即执行任务队列和基于 Cron 表达式的定时任务调度。

## 2. 页面结构

任务调度页面采用顶部状态栏 + 标签页 + 内容列表的布局：

- 顶部：调度器状态指示器
- 中部：标签页导航（任务队列、定时任务、运行中、已完成、失败）
- 底部：对应标签页的内容列表

## 3. 标签页设计

### 3.1 任务队列标签页

显示待执行的任务队列，支持添加任务和删除任务。

表格列：描述、工作目录、创建时间、操作

### 3.2 定时任务标签页

显示所有定时任务，支持创建、编辑、删除定时任务。

表格列：名称、Cron 表达式、下次运行时间、状态、操作

操作按钮：启用/禁用、立即执行、编辑、删除

### 3.3 运行中标签页

显示当前正在执行的任务，支持查看进度和停止任务。

表格列：描述、运行时长、操作

### 3.4 已完成标签页

显示已完成的任务历史，支持分页和查看详情。

表格列：描述、完成时间、耗时、操作

### 3.5 失败标签页

显示执行失败的任务，支持查看错误信息和重试。

表格列：描述、错误信息、操作

## 4. 对话框设计

### 4.1 添加任务对话框

字段：
- 任务描述（必填）
- 工作目录（可选）
- 超时时间（秒，默认 600）
- 自动批准工具操作（复选框）
- 允许使用的工具（多选组件）

### 4.2 添加定时任务对话框

字段：
- 任务名称（必填）
- Cron 表达式（必填，带实时预览）
- 任务描述（必填）
- 工作目录（可选）
- 超时时间（秒，默认 600）
- 自动批准工具操作（复选框）
- 允许使用的工具（多选组件）
- 启用任务（复选框，默认勾选）

### 4.3 Cron 表达式帮助对话框

显示常用 Cron 表达式示例，支持点击选择：

- 0 9 * * * - 每天 9:00
- */30 * * * * - 每 30 分钟
- 0 9 * * 1-5 - 工作日 9:00
- 0 0 * * * - 每天午夜

### 4.4 任务详情对话框

显示任务执行的完整信息：

- 任务描述
- 状态
- 开始时间、结束时间、耗时
- 工具使用统计
- 文件变更列表
- 输出日志（可展开/折叠）

## 5. 调度器状态指示器

显示调度器的运行状态和统计信息：

运行状态：
- 图标：🟢（运行中）/ ⚫（已停止）
- 轮询间隔：10 秒
- 队列任务数
- 定时任务数
- 运行中任务数

操作按钮：启动调度器 / 停止调度器 / 刷新

## 6. 工具多选组件

复用当前会话页面中的 toolsMultiselect.js 组件，支持选择允许使用的工具。

## 7. 响应式设计

| 屏幕宽度 | 布局调整 |
|----------|----------|
| > 1024px | 完整表格显示 |
| 768-1024px | 紧凑表格，部分字段隐藏 |
| < 768px | 卡片式列表，操作按钮展开 |

## 8. 颜色方案

| 状态 | 颜色 | 图标 |
|------|------|------|
| 运行中 | 蓝色 #2196F3 | 🔄 |
| 已完成 | 绿色 #4CAF50 | ✅ |
| 失败 | 红色 #F44336 | ❌ |
| 待执行 | 橙色 #FF9800 | ⏳ |
| 已取消 | 灰色 #9E9E9E | ⏸ |

## 9. 交互流程

### 9.1 添加任务到队列

1. 点击「添加任务」按钮
2. 填写任务对话框
3. 点击「添加到队列」
4. 显示成功提示，刷新任务队列列表

### 9.2 创建定时任务

1. 切换到「定时任务」标签
2. 点击「添加任务」按钮
3. 填写定时任务对话框
4. Cron 表达式实时预览
5. 点击「保存」
6. 显示成功提示，刷新定时任务列表

### 9.3 立即执行定时任务

1. 点击定时任务的「立即执行」按钮
2. 确认对话框
3. 任务立即加入执行队列
4. 切换到「运行中」标签查看进度

### 9.4 查看任务详情

1. 点击已完成或失败任务的「详情」按钮
2. 打开任务详情对话框
3. 展示完整执行信息（工具使用、文件变更、日志）
4. 支持复制日志内容

## 10. 关键文件

| 文件 | 操作 |
|------|------|
| web/templates/index.html | 修改 - 添加任务调度视图 |
| web/static/constants.js | 修改 - 添加 SCHEDULER 视图常量 |
| web/static/modules/navigation.js | 修改 - 添加路由处理 |
| web/static/modules/scheduler.js | 新建 - 任务调度模块 |
