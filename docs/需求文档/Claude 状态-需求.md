# Claude 状态

## 概述

Claude 状态功能整合了环境信息展示、状态查询和工具统计展示三个模块，为用户提供统一的 Claude Code 运行状态查看入口。

> **来源文档**: 本文档由以下需求文档合并而成：
> - 环境信息展示-需求.md
> - 状态查询-需求.md
> - 工具统计展示-需求.md

---

## 1. 环境信息展示

### 1.1 功能概述

在 Web 页面上展示 Claude Code 的基本环境信息，包括 Claude CLI 版本、相关环境变量、配置文件等，让用户无需使用命令行即可查看 Claude Code 的运行状态。

### 1.2 用户场景

| 场景 | 描述 |
|------|------|
| 查看 Claude 版本 | 用户想确认当前运行的 Claude Code 版本号 |
| 查看环境变量 | 用户想了解 Claude Code 使用的环境变量配置 |
| 查看工作目录 | 用户想确认当前配置的 working directory |
| 诊断问题 | 用户遇到问题时，查看环境配置进行排查 |

### 1.3 功能列表

#### 1.3.1 Claude 版本信息

- 显示 Claude Code CLI 版本号
- 显示 SDK 版本号
- 显示运行环境（OS、Python 版本等）

#### 1.3.2 环境变量

- 展示与 Claude Code 相关的环境变量
- 敏感信息（API Key）显示为掩码
- 允许用户复制变量名

#### 1.3.3 配置信息

- 当前工作目录
- 默认权限模式
- 可用工具列表

---

## 2. 状态查询

### 2.1 功能概述

提供基础服务状态和可用工具的查询功能，让用户可以快速了解服务运行状态和 Claude Code 的能力。

### 2.2 用户场景

| 场景 | 描述 |
|------|------|
| 检查服务状态 | 用户想确认服务是否正常运行 |
| 查看工作目录 | 用户想确认当前配置的工作目录 |
| 查看活跃任务 | 用户想了解当前有多少任务在执行 |
| 查看可用工具 | 用户想了解 Claude Code 支持哪些工具 |

### 2.3 功能列表

#### 2.3.1 服务状态

- 获取当前服务运行状态
- 显示信息：
  - 服务状态（running/stopped）
  - 当前工作目录
  - 活跃任务数量

#### 2.3.2 工具列表

- 获取 Claude Code 可用的所有工具
- 显示每个工具的基本信息：
  - 工具名称
  - 功能描述

#### 2.3.3 Web 界面

- 提供 Web 主页供用户访问
- 主页显示服务状态和快速入口

---

## 3. 工具统计展示

### 3.1 功能概述

展示 Claude Code 工具使用情况和权限模式说明，让用户了解各工具的用途和适用场景。

### 3.2 用户场景

| 场景 | 描述 |
|------|------|
| 查看工具使用统计 | 用户想了解哪些工具被使用最频繁 |
| 了解权限模式 | 用户想了解四种权限模式的区别和适用场景 |
| 选择合适的工具 | 用户想了解每个工具的用途 |

### 3.3 功能列表

#### 3.3.1 工具使用统计

- 显示各工具（Read、Write、Edit、Bash、Glob、Grep、WebSearch、WebFetch、Task）的使用次数
- 显示文件变更统计
- 显示任务执行统计（成功率、平均耗时、费用）

#### 3.3.2 权限模式说明

- default：默认模式，每次工具调用需要用户确认
- acceptEdits：自动接受编辑操作
- plan：规划模式，先生成计划再执行
- bypassPermissions：跳过所有权限检查

#### 3.3.3 可用工具列表

- 展示9个内置工具的名称和基本描述

---

## 4. 验收标准

### 4.1 功能验收

- [x] 访问 `/api/claude/version` 返回正确的版本信息
- [x] 访问 `/api/claude/env` 返回环境变量（敏感值已隐藏）
- [x] 访问 `/api/claude/config` 返回当前配置
- [x] 访问 `/api/status` 返回服务状态
- [x] 访问 `/api/tools` 返回工具列表
- [x] 前端页面正确显示以上信息
- [x] 无需登录即可访问 Claude 状态页面
- [x] 工具使用统计正确显示
- [x] 权限模式说明清晰完整
- [x] 可用工具列表完整

### 4.2 UI 验收

- [x] 左侧导航显示「Claude 状态」入口
- [x] 页面布局清晰，信息分区块展示
- [x] 敏感信息显示为 `***` 或部分掩码
- [x] 页面响应流畅，无明显加载延迟

### 4.3 安全验收

- [x] API Key 等敏感信息不暴露
- [x] 环境变量仅返回与 Claude Code 相关的变量

### 4.4 测试验收

- [x] 后端 API 单元测试通过（tests/test_claude_env.py）
- [x] 敏感信息隐藏函数测试通过
- [x] API 端点测试通过
- [x] 安全测试通过 - 无明文敏感数据
- [x] 性能测试通过 - 响应时间 < 100ms
