## 1. æ¶ˆæ¯ç±»å‹å®šä¹‰

| ç±»å‹ | è¯´æ˜ | æ ·å¼ |
|------|------|------|
| text | æ–‡æœ¬å†…å®¹ | è“è‰²è¾¹æ¡† |
| thinking | æ€è€ƒè¿‡ç¨‹ (v0.2.11+) | é»„è‰²èƒŒæ™¯ï¼Œå¯æŠ˜å  |
| tool_use | å·¥å…·è°ƒç”¨ | ç»¿è‰²è¾¹æ¡† |
| tool_result | å·¥å…·ç»“æœ | è“è‰²è¾¹æ¡† |
| error | é”™è¯¯ä¿¡æ¯ | çº¢è‰²è¾¹æ¡† |
| complete | ä»»åŠ¡å®Œæˆ | è“è‰²è¾¹æ¡† |
| info | æç¤ºä¿¡æ¯ | å¤©è“è‰²è¾¹æ¡† |
| ask_user_question | ç”¨æˆ·é—®ç­” (v0.x.x+) | ç´«è‰²è¾¹æ¡†ï¼Œäº¤äº’å¼é€‰é¡¹ |

## 2. ç”¨æˆ·é—®ç­”æ¶ˆæ¯ (ask_user_question)

### 2.1 åŠŸèƒ½æ¦‚è¿°

å½“ Claude Code åœ¨æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä¸­éœ€è¦ç”¨æˆ·ç¡®è®¤ã€é€‰æ‹©æˆ–è¾“å…¥ä¿¡æ¯æ—¶ï¼Œä¼šæš‚åœæ‰§è¡Œå¹¶å‘ç”¨æˆ·æé—®ã€‚ç”¨æˆ·å›ç­”åï¼Œä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚

**ä½¿ç”¨åœºæ™¯ï¼š**
- éœ€è¦ç”¨æˆ·ç¡®è®¤æ“ä½œï¼ˆå¦‚ï¼šæ˜¯å¦åˆ é™¤æ–‡ä»¶ï¼‰
- éœ€è¦ç”¨æˆ·é€‰æ‹©é€‰é¡¹ï¼ˆå¦‚ï¼šé€‰æ‹© A/B/C æ–¹æ¡ˆï¼‰
- éœ€è¦ç”¨æˆ·æä¾›é¢å¤–ä¿¡æ¯ï¼ˆå¦‚ï¼šè¾“å…¥é…ç½®å‚æ•°ï¼‰

### 2.2 æ¶ˆæ¯æ•°æ®ç»“æ„

#### 2.2.1 å·¥å…·è°ƒç”¨ï¼ˆClaude â†’ ç”¨æˆ·ï¼‰

`AskUserQuestion` åœ¨ä¼šè¯ä¸­ä½œä¸º**å·¥å…·è°ƒç”¨**ï¼ˆ`tool_use`ï¼‰æ‰§è¡Œï¼Œå®Œæ•´çš„æ¶ˆæ¯ç»“æ„å¦‚ä¸‹ï¼š

```json
{
  "type": "message",
  "role": "assistant",
  "content": [
    {
      "type": "tool_use",
      "id": "toolu_xxx",
      "name": "ask_user_question",
      "input": {
        "question_id": "auth_strategy_01",
        "question_text": "æ‚¨å¸Œæœ›é‡‡ç”¨å“ªç§èº«ä»½éªŒè¯ç­–ç•¥ï¼Ÿ",
        "description": "è¯·é€‰æ‹©æœ€é€‚åˆå½“å‰é¡¹ç›®å®‰å…¨è¦æ±‚å’Œç”¨æˆ·ä½“éªŒçš„æ–¹æ¡ˆã€‚",
        "type": "multiple_choice",
        "options": [
          {
            "id": "oauth2",
            "label": "OAuth 2.0 (æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ)",
            "description": "æ”¯æŒç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆGoogle/GitHubï¼‰ï¼Œç¬¦åˆç°ä»£å®‰å…¨æ ‡å‡†ã€‚",
            "default": true
          },
          {
            "id": "jwt_local",
            "label": "JWT + æœ¬åœ°è´¦å·",
            "description": "ç”¨æˆ·æ³¨å†Œ/ç™»å½•ä½¿ç”¨é‚®ç®±å¯†ç ï¼ŒToken å­˜å‚¨åœ¨å®¢æˆ·ç«¯ã€‚"
          },
          {
            "id": "session_cookie",
            "label": "Session + Cookie",
            "description": "æœåŠ¡ç«¯ç»´æŠ¤ä¼šè¯çŠ¶æ€ï¼Œé€‚åˆä¼ ç»Ÿ Web åº”ç”¨ã€‚"
          }
        ],
        "required": true,
        "follow_up_questions": {
          "oauth2": [
            {
              "question_id": "oauth_providers",
              "question_text": "è¯·é€‰æ‹©è¦é›†æˆçš„ OAuth æä¾›å•†ï¼š",
              "type": "checkbox",
              "options": [
                { "id": "google", "label": "Google" },
                { "id": "github", "label": "GitHub" },
                { "id": "microsoft", "label": "Microsoft" }
              ]
            }
          ]
        }
      }
    }
  ]
}
```

#### 2.2.2 å·¥å…·ç»“æœï¼ˆç”¨æˆ· â†’ Claudeï¼‰

ç”¨æˆ·ä½œç­”åï¼Œé€šè¿‡ `tool_result` è¿”å›ç­”æ¡ˆï¼š

```json
{
  "type": "message",
  "role": "user",
  "content": [
    {
      "type": "tool_result",
      "tool_use_id": "toolu_xxx",
      "content": "{\"question_id\": \"auth_strategy_01\", \"answer\": \"oauth2\"}"
    }
  ]
}
```

#### 2.2.3 å®Œæ•´ä¼šè¯æ¶ˆæ¯é“¾ï¼ˆJSONL æ ¼å¼ï¼‰

```jsonl
{"type": "user", "message": {"role": "user", "content": [{"type": "text", "text": "å¸®æˆ‘å®ç°ç™»å½•åŠŸèƒ½"}]}, "uuid": "msg_001", "parentUuid": null, "cwd": "e:\\project", "sessionId": "xxx"}
{"type": "assistant", "message": {"role": "assistant", "content": [{"type": "tool_use", "id": "toolu_001", "name": "ask_user_question", "input": {...}}]}, "uuid": "msg_002", "parentUuid": "msg_001"}
{"type": "user", "message": {"role": "user", "content": [{"type": "tool_result", "tool_use_id": "toolu_001", "content": "{\"answer\": \"oauth2\"}"}]}, "uuid": "msg_003", "parentUuid": "msg_002"}
{"type": "assistant", "message": {"role": "assistant", "content": [{"type": "text", "text": "å¥½çš„ï¼Œæˆ‘æ¥å®ç° OAuth 2.0 ç™»å½•..."}]}, "uuid": "msg_004", "parentUuid": "msg_003"}
```

#### 2.2.4 ç®€åŒ–çš„é—®ç­”æ¶ˆæ¯ç»“æ„ï¼ˆAPI æ¨é€æ ¼å¼ï¼‰

åœ¨å®é™… API æ¨é€ä¸­ï¼Œå¯ä»¥ç®€åŒ–å¤–å±‚åŒ…è£…ï¼Œç›´æ¥ä¼ é€’é—®é¢˜å†…å®¹ï¼š

```json
{
  "type": "ask_user_question",
  "question": {
    "question_id": "auth_strategy_01",
    "header": "ç¡®è®¤æ“ä½œ",
    "question_text": "ç¡®å®šè¦åˆ é™¤ä»¥ä¸‹æ–‡ä»¶å—ï¼Ÿ",
    "description": "è¯·ç¡®è®¤æ˜¯å¦åˆ é™¤ï¼Œè¿™äº›æ“ä½œä¸å¯æ’¤é”€ã€‚",
    "type": "multiple_choice",
    "options": [
      {
        "id": "option_a",
        "label": "é€‰é¡¹ A",
        "description": "é€‰é¡¹ A çš„æè¿°è¯´æ˜",
        "default": false
      },
      {
        "id": "option_b",
        "label": "é€‰é¡¹ B",
        "description": "é€‰é¡¹ B çš„æè¿°è¯´æ˜",
        "default": true
      }
    ],
    "required": true,
    "follow_up_questions": {
      "oauth2": [
        {
          "question_id": "oauth_providers",
          "question_text": "è¯·é€‰æ‹©è¦é›†æˆçš„ OAuth æä¾›å•†ï¼š",
          "type": "checkbox",
          "options": [
            { "id": "google", "label": "Google" },
            { "id": "github", "label": "GitHub" }
          ]
        }
      ]
    }
  },
  "tool_use_id": "toolu_xxx",
  "timestamp": "2026-02-19T10:00:00.000Z"
}
```

### 2.3 æ•°æ®å­—æ®µè¯´æ˜

#### 2.3.1 å·¥å…·è°ƒç”¨å±‚å­—æ®µï¼ˆtool_useï¼‰

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| type | string | æ˜¯ | å›ºå®šä¸º "tool_use" |
| id | string | æ˜¯ | å·¥å…·è°ƒç”¨å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºå…³è” tool_result |
| name | string | æ˜¯ | å›ºå®šä¸º "ask_user_question" |
| input | object | æ˜¯ | é—®é¢˜æ•°æ®å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰é—®é¢˜å†…å®¹ |

#### 2.3.2 é—®é¢˜è¾“å…¥å­—æ®µï¼ˆinput/questionï¼‰

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| question_id | string | æ˜¯ | é—®é¢˜å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºè·Ÿè¸ªå’Œæ¡ä»¶åˆ†æ”¯ |
| header | string | å¦ | é—®é¢˜æ ‡é¢˜/æ ‡ç­¾ï¼ˆå»ºè®®æœ€å¤š12å­—ç¬¦ï¼‰ |
| question_text | string | æ˜¯ | å‘ç”¨æˆ·æ˜¾ç¤ºçš„æ ¸å¿ƒé—®é¢˜æ–‡æœ¬ |
| description | string | å¦ | é—®é¢˜ä¸Šä¸‹æ–‡æˆ–é€‰é¡¹è§£é‡Šè¯´æ˜ |
| type | enum | æ˜¯ | é—®é¢˜ç±»å‹ï¼š<br>â€¢ `multiple_choice`ï¼ˆå•é€‰ï¼‰<br>â€¢ `checkbox`ï¼ˆå¤šé€‰ï¼‰<br>â€¢ `text`ï¼ˆè‡ªç”±æ–‡æœ¬ï¼‰<br>â€¢ `boolean`ï¼ˆæ˜¯/å¦ï¼‰ |
| options | array | æ¡ä»¶ | å½“ type ä¸ºé€‰æ‹©ç±»æ—¶å¿…å¡« |
| options[].id | string | æ˜¯ | æœºå™¨å¯è¯»å€¼ï¼Œç”¨äºç¨‹åºè§£æ |
| options[].label | string | æ˜¯ | ç”¨æˆ·å¯è§æ–‡æœ¬ |
| options[].description | string | å¦ | é€‰é¡¹è¯¦ç»†è¯´æ˜ |
| options[].default | boolean | å¦ | æ˜¯å¦é»˜è®¤é€‰ä¸­ |
| required | boolean | å¦ | é»˜è®¤ trueï¼Œæ˜¯å¦å¿…é¡»å›ç­” |
| follow_up_questions | object | å¦ | æ¡ä»¶è¿½é—®ï¼šé”®ä¸ºçˆ¶é€‰é¡¹ idï¼Œå€¼ä¸ºå­é—®é¢˜æ•°ç»„ |

#### 2.3.3 å·¥å…·ç»“æœå­—æ®µï¼ˆtool_resultï¼‰

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| type | string | æ˜¯ | å›ºå®šä¸º "tool_result" |
| tool_use_id | string | æ˜¯ | å¯¹åº” tool_use çš„ idï¼Œç”¨äºå…³è”é—®ç­” |
| content | string | æ˜¯ | ç”¨æˆ·ç­”æ¡ˆçš„ JSON å­—ç¬¦ä¸² |

### 2.4 ç”¨æˆ·å›ç­”è¾“å‡ºç»“æ„

å½“ç”¨æˆ·ä½œç­”åï¼Œç³»ç»Ÿè¿”å›ç»“æ„åŒ–ç»“æœï¼š

**å•é€‰ç¤ºä¾‹ï¼š**
```json
{
  "question_id": "auth_strategy_01",
  "answer": "oauth2"
}
```

**å¤šé€‰ç¤ºä¾‹ï¼š**
```json
{
  "question_id": "oauth_providers",
  "answer": ["google", "github"]
}
```

**æ–‡æœ¬è¾“å…¥ç¤ºä¾‹ï¼š**
```json
{
  "question_id": "custom_port",
  "answer": "8080"
}
```

### 2.5 å‰ç«¯äº¤äº’è®¾è®¡

#### 2.5.1 é—®ç­”æ¶ˆæ¯æ˜¾ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ ç¡®è®¤æ“ä½œ                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¡®å®šè¦åˆ é™¤ä»¥ä¸‹æ–‡ä»¶å—ï¼Ÿ                                  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â—‹ é€‰é¡¹ A - é€‰é¡¹ A çš„æè¿°è¯´æ˜                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â— é€‰é¡¹ B - é€‰é¡¹ B çš„æè¿°è¯´æ˜                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        å–æ¶ˆ          â”‚  â”‚        ç¡®è®¤          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.5.2 é€‰é¡¹ç±»å‹

| ç±»å‹ | è¯´æ˜ | äº¤äº’æ–¹å¼ |
|------|------|----------|
| multiple_choice | å•é€‰ï¼Œç”¨æˆ·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹ | åœ†å½¢å•é€‰æŒ‰é’® |
| checkbox | å¤šé€‰ï¼Œç”¨æˆ·é€‰æ‹©å¤šä¸ªé€‰é¡¹ | æ–¹å½¢å¤é€‰æ¡† |
| text | è‡ªç”±æ–‡æœ¬è¾“å…¥ | æ–‡æœ¬è¾“å…¥æ¡† |
| boolean | æ˜¯/å¦é€‰æ‹© | å¼€å…³æˆ–å•é€‰æŒ‰é’® |

#### 2.5.3 æ¡ä»¶è¿½é—® (follow_up_questions)

å½“ç”¨æˆ·é€‰æ‹©ç‰¹å®šé€‰é¡¹åï¼Œå¯è§¦å‘è¿½é—®é—®é¢˜ï¼š

```
ç”¨æˆ·é€‰æ‹© "OAuth 2.0" åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯·é€‰æ‹©è¦é›†æˆçš„ OAuth æä¾›å•†ï¼š                            â”‚
â”‚                                                         â”‚
â”‚  â˜ Google                                              â”‚
â”‚  â˜‘ GitHub                                              â”‚
â”‚  â˜ Microsoft                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.5.4 ç”¨æˆ·æ“ä½œ

| æ“ä½œ | è§¦å‘æ–¹å¼ | å“åº” |
|------|----------|------|
| é€‰æ‹©é€‰é¡¹ | ç‚¹å‡»é€‰é¡¹ | é«˜äº®é€‰ä¸­ï¼Œå¯å¤šé€‰ |
| æäº¤å›ç­” | ç‚¹å‡»"ç¡®è®¤"æŒ‰é’® | å‘é€å›ç­”ç»™åç«¯ï¼Œä»»åŠ¡ç»§ç»­æ‰§è¡Œ |
| å–æ¶ˆé—®ç­” | ç‚¹å‡»"å–æ¶ˆ"æŒ‰é’® | å‘é€ç©ºå›ç­”æˆ–å–æ¶ˆä¿¡å·ï¼Œä»»åŠ¡å¯èƒ½ç»ˆæ­¢ |
| ä»»åŠ¡ç»§ç»­ | åç«¯æ”¶åˆ°å›ç­” | æ¢å¤ä»»åŠ¡æ‰§è¡Œï¼Œæ˜¾ç¤ºåç»­è¾“å‡º |

### 2.6 åç«¯ API è®¾è®¡

#### 2.6.1 é—®ç­”æ¶ˆæ¯æ¨é€

é€šè¿‡ SSE æµå¼æ¨é€ ask_user_question ç±»å‹æ¶ˆæ¯ï¼š

```json
{
  "type": "ask_user_question",
  "question": {
    "question_id": "auth_strategy_01",
    "header": "ç¡®è®¤æ“ä½œ",
    "question_text": "ç¡®å®šè¦åˆ é™¤ä»¥ä¸‹æ–‡ä»¶å—ï¼Ÿ",
    "description": "è¯·ç¡®è®¤æ˜¯å¦åˆ é™¤ï¼Œè¿™äº›æ“ä½œä¸å¯æ’¤é”€ã€‚",
    "type": "multiple_choice",
    "options": [
      {
        "id": "option_a",
        "label": "é€‰é¡¹ A",
        "description": "é€‰é¡¹ A çš„æè¿°è¯´æ˜"
      },
      {
        "id": "option_b",
        "label": "é€‰é¡¹ B",
        "description": "é€‰é¡¹ B çš„æè¿°è¯´æ˜"
      }
    ],
    "required": true
  },
  "timestamp": "2026-02-19T10:00:00.000Z"
}
```

#### 2.6.2 ç”¨æˆ·å›ç­”æäº¤

```
POST /api/task/answer
Content-Type: application/json

{
  "session_id": "session_xxx",
  "question_id": "auth_strategy_01",
  "answer": "option_a"
}
```

**å¤šé€‰å›ç­”æ ¼å¼ï¼š**
```json
{
  "session_id": "session_xxx",
  "question_id": "oauth_providers",
  "answer": ["google", "github"]
}
```

**æ–‡æœ¬è¾“å…¥å›ç­”æ ¼å¼ï¼š**
```json
{
  "session_id": "session_xxx",
  "question_id": "custom_port",
  "answer": "8080"
}
```

#### 2.6.3 å›ç­”å“åº”

```json
{
  "success": true,
  "message": "ç­”æ¡ˆå·²æäº¤ï¼Œä»»åŠ¡ç»§ç»­æ‰§è¡Œ"
}
```

### 2.7 çŠ¶æ€ç®¡ç†

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| pending | ç­‰å¾…ç”¨æˆ·å›ç­” |
| answered | ç”¨æˆ·å·²å›ç­” |
| cancelled | ç”¨æˆ·å–æ¶ˆé—®ç­” |
| timeout | é—®ç­”è¶…æ—¶ï¼ˆå¯é…ç½®è¶…æ—¶æ—¶é—´ï¼‰ |

### 2.8 é”™è¯¯å¤„ç†

| é”™è¯¯ç±»å‹ | HTTP çŠ¶æ€ç  | è¯´æ˜ |
|----------|-------------|------|
| session_not_found | 404 | ä¼šè¯ä¸å­˜åœ¨ |
| question_not_found | 404 | é—®é¢˜ä¸å­˜åœ¨ï¼ˆå·²è¶…æ—¶æˆ–å·²å›ç­”ï¼‰ |
| invalid_answer | 400 | ç­”æ¡ˆæ ¼å¼æ— æ•ˆ |
| task_interrupted | 400 | ä»»åŠ¡å·²è¢«ä¸­æ–­ |

### 2.9 å¤šç¯å¢ƒé€‚é…

#### 2.9.1 CLI ç•Œé¢

- æ¸²æŸ“ä¸ºå¸¦ç¼–å·çš„é€‰é¡¹åˆ—è¡¨
- æ”¯æŒç®­å¤´é”®å¯¼èˆªå’Œå›è½¦ç¡®è®¤
- è‡ªåŠ¨å¤„ç† `follow_up_questions` çš„çº§è”æ˜¾ç¤º

#### 2.9.2 Web ç•Œé¢

- ä½œä¸ºç‹¬ç«‹ç»„ä»¶ `UserQuestionPanel` å­˜åœ¨
- å±•ç¤ºäº¤äº’å¼é—®ç­”å¡ç‰‡ï¼Œç­‰å¾…ç”¨æˆ·é€‰æ‹©
- ç”¨æˆ·é€‰æ‹©åè°ƒç”¨ `/api/task/answer` ç»§ç»­æ‰§è¡Œ

#### 2.9.3 MCPï¼ˆModel Context Protocolï¼‰

é€šè¿‡æ ‡å‡†å·¥å…·è°ƒç”¨æ ¼å¼ä¼ è¾“ï¼š

```json
{
  "name": "ask_user_question",
  "input": {
    "question_id": "auth_strategy_01",
    "question_text": "æ‚¨å¸Œæœ›é‡‡ç”¨å“ªç§èº«ä»½éªŒè¯ç­–ç•¥ï¼Ÿ",
    "type": "multiple_choice",
    "options": [...]
  }
}
```

MCP æœåŠ¡å™¨è´Ÿè´£æ¸²æŸ“ UI å¹¶è¿”å›ç”¨æˆ·è¾“å…¥ã€‚

### 2.10 å¼€å‘è€…è‡ªå®šä¹‰æ‰©å±•

ç”¨æˆ·å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰©å±•ï¼š

- åœ¨ `.claude/skills/` ä¸­å®šä¹‰åŒ…å« `ask_user_question` çš„ Skill
- é€šè¿‡ MCP å®ç°è‡ªå®šä¹‰ UIï¼ˆå¦‚ Web è¡¨å•ã€ç§»åŠ¨ç«¯å¼¹çª—ï¼‰
- åœ¨ Web ç•Œé¢ä¸­é€šè¿‡ `/api/task/answer` æ¥å£æäº¤ç”¨æˆ·ç­”æ¡ˆ

## 3. å†å²æ¶ˆæ¯æ¸²æŸ“ (v0.2.11+)

- æ”¯æŒå¤šè½®å¯¹è¯æ˜¾ç¤ºï¼Œæ¯è½®åŒ…å«ç”¨æˆ·è¾“å…¥å’Œ AI å“åº”
- æŒ‰è½®æ¬¡åˆ†ç»„æ˜¾ç¤ºï¼Œæ¯è½®æ˜¾ç¤ºè½®æ¬¡ç¼–å·
- å·¥å…·è°ƒç”¨æ˜¾ç¤ºå·¥å…·åç§°å’Œå‚æ•°
- å·¥å…·ç»“æœå¯åŒºåˆ†æˆåŠŸ/é”™è¯¯çŠ¶æ€
- æ€è€ƒè¿‡ç¨‹é»˜è®¤æŠ˜å ï¼Œç‚¹å‡»å¯å±•å¼€

## 4. ä¸šåŠ¡è§„åˆ™

### 4.1 é—®ç­”ç”Ÿå‘½å‘¨æœŸè§„åˆ™

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| **ç”Ÿå‘½å‘¨æœŸ** | é—®ç­”æ¶ˆæ¯å‘å‡º â†’ ç”¨æˆ·å›ç­”/å–æ¶ˆ â†’ ä»»åŠ¡ç»§ç»­/ç»ˆæ­¢ |
| **é˜»å¡æ‰§è¡Œ** | é—®ç­”æ¶ˆæ¯ä¼šé˜»å¡ Claude Code æ‰§è¡Œï¼Œç›´è‡³ç”¨æˆ·å›ç­” |
| **çŠ¶æ€è¿½æº¯** | æ¯æ¡é—®ç­”æœ‰å”¯ä¸€ question_idï¼Œæ”¯æŒå®¡è®¡å’Œæ–­ç‚¹ç»­ä¼  |
| **è¶…æ—¶æœºåˆ¶** | å¯é…ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶åé€‰æ‹©é»˜è®¤é€‰é¡¹æˆ–ç»ˆæ­¢ä»»åŠ¡ |

### 4.2 æ•°æ®æ ¼å¼è§„åˆ™

#### 4.2.1 é—®é¢˜å®šä¹‰è§„åˆ™

```
é—®é¢˜è¾“å…¥æ ¼å¼ï¼š
- question_id: åŒä¸€ä¼šè¯å†…å¿…é¡»å”¯ä¸€
- question_text: ç”¨æˆ·å¯è§é—®é¢˜æ–‡æœ¬ï¼Œå¿…å¡«
- type: å¿…å¡«ï¼Œå†³å®šäº¤äº’å½¢å¼
- options: é€‰æ‹©ç±»é—®é¢˜å¿…å¡«ï¼Œè‡³å°‘1ä¸ªé€‰é¡¹
```

```
é€‰é¡¹å®šä¹‰è§„åˆ™ï¼š
- id: æœºå™¨å¯è¯»æ ‡è¯†ç¬¦ï¼ŒåŒä¸€é—®é¢˜å†…å”¯ä¸€
- label: ç”¨æˆ·å¯è§æ–‡æœ¬ï¼Œå¿…å¡«
- description: å¯é€‰ï¼Œç”¨äºè¯¦ç»†è¯´æ˜
- default: å¯é€‰ï¼Œé»˜è®¤é€‰ä¸­çš„é€‰é¡¹
```

#### 4.2.2 ç­”æ¡ˆæ ¼å¼è§„åˆ™

```
ç­”æ¡ˆæ ¼å¼ç”±é—®é¢˜ç±»å‹å†³å®šï¼š
- multiple_choice: ç­”æ¡ˆ = "é€‰é¡¹id" (å­—ç¬¦ä¸²)
- checkbox: ç­”æ¡ˆ = ["é€‰é¡¹id1", "é€‰é¡¹id2"] (å­—ç¬¦ä¸²æ•°ç»„)
- text: ç­”æ¡ˆ = "ç”¨æˆ·è¾“å…¥æ–‡æœ¬" (å­—ç¬¦ä¸²)
- boolean: ç­”æ¡ˆ = true/false (å¸ƒå°”å€¼)
```

### 4.3 æ¡ä»¶è¿½é—®è§„åˆ™ (follow_up_questions)

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| **è§¦å‘æ¡ä»¶** | ç”¨æˆ·é€‰æ‹©ç‰¹å®šé€‰é¡¹åè‡ªåŠ¨æ˜¾ç¤ºè¿½é—® |
| **åµŒå¥—å±‚çº§** | æ”¯æŒå¤šçº§è¿½é—®ï¼ˆçˆ¶é—®é¢˜ â†’ å­é—®é¢˜ â†’ å­™é—®é¢˜ï¼‰ |
| **ç­”æ¡ˆå…³è”** | è¿½é—®ç­”æ¡ˆä¸çˆ¶é—®é¢˜ç­”æ¡ˆä¸€èµ·æäº¤ç»™ Claude |
| **åŠ¨æ€æ˜¾ç¤º** | æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„çˆ¶é€‰é¡¹åŠ¨æ€æ¸²æŸ“ç›¸å…³å­é—®é¢˜ |

**è¿½é—®ç»“æ„ç¤ºä¾‹ï¼š**
```json
"follow_up_questions": {
  "oauth2": [          // å½“ç”¨æˆ·é€‰æ‹© oauth2 æ—¶è§¦å‘
    {
      "question_id": "oauth_providers",
      "question_text": "è¯·é€‰æ‹© OAuth æä¾›å•†",
      "type": "checkbox",
      "options": [...]
    }
  ]
}
```

### 4.4 æ•°æ®ä¸€è‡´æ€§è§„åˆ™

| è§„åˆ™ | çº¦æŸ | è¿åå¤„ç† |
|------|------|----------|
| ID å”¯ä¸€æ€§ | åŒä¸€ä¼šè¯å†… question_id ä¸å¯é‡å¤ | è¿”å› 400 é”™è¯¯ |
| é€‰é¡¹éç©º | é€‰æ‹©ç±»é—®é¢˜ options è‡³å°‘1é¡¹ | è¿”å› 400 é”™è¯¯ |
| ç­”æ¡ˆæœ‰æ•ˆæ€§ | ç­”æ¡ˆå€¼å¿…é¡»åœ¨é€‰é¡¹èŒƒå›´å†… | è¿”å› 400 é”™è¯¯ |
| å¿…ç­”çº¦æŸ | required=true æ—¶å¿…é¡»å›ç­” | è¶…æ—¶ç»ˆæ­¢ä»»åŠ¡ |
| ä¼šè¯ç»‘å®š | ç­”æ¡ˆå¿…é¡»å…³è”æ­£ç¡®çš„ session_id | è¿”å› 404 é”™è¯¯ |

### 4.5 å®‰å…¨æ€§è§„åˆ™

| è§„åˆ™ | å…·ä½“çº¦æŸ |
|------|----------|
| **è¾“å…¥è¿‡æ»¤** | text ç±»å‹è¾“å…¥éœ€è¿‡æ»¤å±é™©å­—ç¬¦ï¼Œé˜²æ­¢ XSS |
| **é•¿åº¦é™åˆ¶** | å•é€‰ç­”æ¡ˆ â‰¤ 256 å­—ç¬¦ï¼Œå¤šé€‰ç­”æ¡ˆ â‰¤ 1000 å­—ç¬¦ |
| **ä¼šè¯éªŒè¯** | éªŒè¯ session_id æœ‰æ•ˆæ€§ï¼Œé˜²æ­¢è·¨ä¼šè¯æ”»å‡» |
| **é˜²é‡æ”¾** | åŒä¸€ question_id åªèƒ½å›ç­”ä¸€æ¬¡ï¼Œé‡å¤æäº¤è¿”å› 400 |

### 4.6 å¤šç¯å¢ƒé€‚é…è§„åˆ™

| ç¯å¢ƒ | é€‚é…è§„åˆ™ |
|------|----------|
| **CLI** | æ¸²æŸ“ä¸ºå¸¦ç¼–å·åˆ—è¡¨ï¼Œæ”¯æŒç®­å¤´é”®å¯¼èˆªå’Œå›è½¦ç¡®è®¤ |
| **Web** | æ¸²æŸ“ä¸ºäº¤äº’å¼è¡¨å•ç»„ä»¶ï¼Œæ˜¾ç¤ºç¡®è®¤/å–æ¶ˆæŒ‰é’® |
| **MCP** | é€šè¿‡æ ‡å‡†å·¥å…·è°ƒç”¨ä¼ è¾“ï¼ŒMCP æœåŠ¡å™¨è´Ÿè´£æ¸²æŸ“ UI |

### 4.7 å¼€å‘è€…æ‰©å±•è§„åˆ™

| æ‰©å±•æ–¹å¼ | é€‚ç”¨èŒƒå›´ |
|----------|----------|
| **Skill å®šä¹‰** | åœ¨ `.claude/skills/` ä¸­é¢„å®šä¹‰é—®ç­”æ¨¡æ¿ |
| **MCP æ‰©å±•** | è‡ªå®šä¹‰ UI æ¸²æŸ“é€»è¾‘ï¼ˆWebè¡¨å•ã€ç§»åŠ¨ç«¯å¼¹çª—ï¼‰ |
| **API åŠ¨æ€é…ç½®** | é€šè¿‡ API åŠ¨æ€ä¼ å…¥é—®ç­”é…ç½® |

---

## 5. è®¾è®¡åŸåˆ™ï¼ˆå‚è€ƒï¼‰

> ä»¥ä¸‹å†…å®¹æ¥è‡ª Anthropic å®˜æ–¹ AskUserQuestion è®¾è®¡è§„èŒƒï¼Œä¾›ç†è§£è®¾è®¡æ„å›¾å‚è€ƒã€‚

### 5.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ç»“æ„åŒ–ä¼˜äºè‡ªç”±æ–‡æœ¬**
   - å¼ºåˆ¶ä½¿ç”¨ `id` è€Œéè‡ªç„¶è¯­è¨€ç­”æ¡ˆï¼Œä¾¿äºç¨‹åºè§£æ
   - æ‰€æœ‰é€‰é¡¹å¿…é¡»åŒ…å«æœºå™¨å¯è¯»çš„å”¯ä¸€æ ‡è¯†ç¬¦

2. **æ¸è¿›å¼æŠ«éœ²**
   - é€šè¿‡ `follow_up_questions` é¿å…ä¸€æ¬¡æ€§æŠ›å‡ºè¿‡å¤šé—®é¢˜
   - æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„çˆ¶é€‰é¡¹åŠ¨æ€æ˜¾ç¤ºç›¸å…³å­é—®é¢˜

3. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**
   - é—®é¢˜å†…å®¹å¯å¼•ç”¨å½“å‰é¡¹ç›®æ–‡ä»¶
   - æ”¯æŒåŸºäºé¡¹ç›®çŠ¶æ€åŠ¨æ€ç”Ÿæˆé—®é¢˜å†…å®¹

4. **å¯è¿½æº¯æ€§**
   - æ¯ä¸ª `question_id` å¯¹åº”ä¸€ä¸ªå†³ç­–ç‚¹ï¼Œä¾¿äºå®¡è®¡å’Œå›æ»š
   - æ”¯æŒæ–­ç‚¹ç»­ä¼ 

5. **ä¼šè¯å…³è”**
   - é€šè¿‡ `tool_use_id` å…³è”é—®ç­”ä¸ç­”æ¡ˆï¼Œä¿æŒä¼šè¯æ¶ˆæ¯é“¾å®Œæ•´
   - é—®é¢˜å’Œç­”æ¡ˆä½œä¸ºç‹¬ç«‹æ¶ˆæ¯å­˜åœ¨äºä¼šè¯å†å²ä¸­

