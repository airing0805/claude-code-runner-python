# 任务调度 - 调度器状态组件设计

> 本文档定义任务调度视图中调度器状态指示器组件的设计，包括组件结构、接口设计、实时更新方案和状态颜色规范。

## 1. 组件概述

### 1.1 设计目标

调度器状态指示器是一个位于任务调度视图顶部的信息展示与控制组件，用于：

- 实时显示调度器运行状态
- 展示关键统计数据（队列任务数、定时任务数、运行中任务数）
- 提供快捷操作按钮（启动/停止/刷新）

### 1.2 组件位置

任务调度视图 (view-scheduler) 中，状态栏位于页面标题下方、标签页导航上方。

## 2. HTML 结构设计

### 2.1 DOM 结构

```html
<div class="scheduler-status-bar" id="scheduler-status-bar">
    <div class="scheduler-status-left">
        <span class="scheduler-status-icon" id="scheduler-status-icon">⏸</span>
        <span class="scheduler-status-text" id="scheduler-status-text">已停止</span>
    </div>
    <div class="scheduler-stats">
        <span class="scheduler-stat">
            <span class="stat-value" id="scheduler-queue-count">0</span>
            <span class="stat-label">队列</span>
        </span>
        <span class="scheduler-stat">
            <span class="stat-value" id="scheduler-scheduled-count">0</span>
            <span class="stat-label">定时</span>
        </span>
        <span class="scheduler-stat">
            <span class="stat-value" id="scheduler-running-count">0</span>
            <span class="stat-label">运行</span>
        </span>
    </div>
    <div class="scheduler-actions">
        <button class="btn btn-small" id="scheduler-start-btn">▶ 启动</button>
        <button class="btn btn-small" id="scheduler-stop-btn" style="display:none">⏹ 停止</button>
        <button class="btn btn-small" id="scheduler-refresh-btn">🔄 刷新</button>
    </div>
</div>
```

### 2.2 元素 ID 映射表

| ID | 用途 |
|----|------|
| scheduler-status-icon | 状态图标 |
| scheduler-status-text | 状态文本 |
| scheduler-queue-count | 队列任务数 |
| scheduler-scheduled-count | 定时任务数 |
| scheduler-running-count | 运行中任务数 |
| scheduler-start-btn | 启动按钮 |
| scheduler-stop-btn | 停止按钮 |
| scheduler-refresh-btn | 刷新按钮 |

## 3. 组件接口设计

### 3.1 状态数据结构

```javascript
state: {
    scheduler: {
        isRunning: false,
        lastCheckTime: null,
    },
    stats: {
        queueCount: 0,
        scheduledCount: 0,
        runningCount: 0,
    },
}
```

### 3.2 核心方法

| 方法 | 说明 |
|------|------|
| renderSchedulerStatus() | 渲染调度器状态 |
| updateStats() | 更新统计信息 |
| loadSchedulerStatus() | 从 API 加载状态 |
| startScheduler() | 启动调度器 |
| stopScheduler() | 停止调度器 |

## 4. 实时更新方案

### 4.1 轮询配置

| 配置项 | 值 | 说明 |
|--------|-----|------|
| REFRESH_INTERVAL_MS | 5000 | 状态刷新间隔（5秒） |
| DURATION_UPDATE_MS | 1000 | 运行时长更新间隔（1秒） |

### 4.2 生命周期管理

- onShow(): 开始自动刷新
- onHide(): 停止自动刷新

## 5. 状态颜色规范

| 状态 | 图标 | 文本 | 颜色 | CSS 类 |
|------|------|------|------|--------|
| 运行中 | ▶ | 运行中 | #4CAF50 (绿色) | .scheduler-status-icon.running |
| 已停止 | ⏸ | 已停止 | var(--text-muted) (灰色) | .scheduler-status-icon.stopped |

### 5.1 CSS 样式

```css
.scheduler-status-icon.running {
    color: #4CAF50;
}

.scheduler-status-icon.stopped {
    color: var(--text-muted);
}
```

## 6. 操作按钮

| 按钮 | 行为 | 可见性 |
|------|------|--------|
| 启动 | 调用 startScheduler() | 停止状态可见 |
| 停止 | 调用 stopScheduler() | 运行状态可见 |
| 刷新 | 调用 loadAll() | 始终可见 |

## 7. 响应式设计

| 断点 | 布局 |
|------|------|
| > 1024px | 三列水平布局 |
| 768px - 1024px | 自动换行 |
| < 768px | 垂直堆叠 |

## 8. 错误处理

- API 调用失败：Toast 通知显示错误消息
- 状态加载失败：控制台记录错误，不阻塞 UI

## 9. 相关文档

- 任务调度-核心设计.md
- 任务调度-调度器.md
- 任务调度-前端架构.md
