# Teams 团队协作

## 概述

支持团队协作功能，包括团队创建、成员邀请、角色权限管理、团队配额控制和使用统计。

## 需求

### 16.1 核心功能

| 功能 | 描述 |
|------|------|
| 团队管理 | 创建、更新、删除团队 |
| 成员管理 | 邀请成员、移除成员、修改角色 |
| 权限控制 | Owner/Admin/Member 角色权限 |
| 配额管理 | 团队月度请求数和费用配额 |
| 使用统计 | 团队和成员使用情况统计 |

### 16.2 角色权限

| 操作 | Owner | Admin | Member |
|------|-------|-------|--------|
| 创建团队 | ✓ | - | - |
| 删除团队 | ✓ | - | - |
| 更新团队 | ✓ | ✓ | - |
| 邀请成员 | ✓ | ✓ | - |
| 移除成员 | ✓ | ✓ | - |
| 更新角色 | ✓ | ✓ | - |
| 查看统计 | ✓ | ✓ | - |
| 使用 API | ✓ | ✓ | ✓ |

### 16.3 API 设计

```json
# 创建团队
POST /api/teams

Request:
{
  "name": "AI Development Team",
  "description": "负责AI项目开发",
  "quota_monthly_requests": 5000,
  "quota_monthly_cost_usd": 500.0
}

Response: 201 Created
{
  "team_id": "team_abc123",
  "name": "AI Development Team",
  ...
}

# 获取团队列表
GET /api/teams

# 获取团队详情
GET /api/teams/{team_id}

# 更新团队
PUT /api/teams/{team_id}

# 删除团队
DELETE /api/teams/{team_id}

# 获取团队成员
GET /api/teams/{team_id}/members

# 邀请成员
POST /api/teams/{team_id}/members

Request:
{
  "username": "john_doe",
  "role": "member"
}

# 移除成员
DELETE /api/teams/{team_id}/members/{member_id}

# 更新成员角色
PUT /api/teams/{team_id}/members/{member_id}/role

# 接受邀请
POST /api/teams/{team_id}/members/{member_id}/accept

# 获取团队使用统计
GET /api/teams/{team_id}/usage

Response: 200 OK
{
  "team_id": "team_abc123",
  "usage": {
    "total_requests": 1234,
    "total_cost_usd": 45.67,
    "requests_used_percent": 24.68,
    "cost_used_percent": 9.13
  },
  "quota": {
    "monthly_requests": 5000,
    "monthly_cost_usd": 500.0
  }
}

# 获取团队配额
GET /api/teams/{team_id}/quota

# 更新团队配额
PUT /api/teams/{team_id}/quota
```

### 16.4 UI 设计

- 团队列表卡片（成员数、使用率）
- 团队详情页（概览、成员列表、工具统计）
- 邀请成员对话框
- 配额使用进度条

### 16.5 优先级

| 功能 | 优先级 |
|------|--------|
| 创建团队 | P0 |
| 团队列表 | P0 |
| 邀请成员 | P0 |
| 成员列表 | P0 |
| 移除成员 | P0 |
| 使用统计 | P0 |
| 配额检查 | P0 |
| 更新角色 | P1 |
| 配额管理 | P1 |

## 数据模型

```python
class Team:
    id: str
    name: str
    description: str
    owner_id: str
    quota_monthly_requests: int
    quota_monthly_cost_usd: float

class TeamMember:
    id: str
    team_id: str
    user_id: str
    role: "owner" | "admin" | "member"
    status: "pending" | "active"
```

## 存储方案

- 初期使用内存存储
- 生产环境迁移到数据库
