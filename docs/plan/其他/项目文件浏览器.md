# 项目文件浏览器

## 概述

通过浏览器直观地浏览项目文件结构、预览文件内容。充分利用 Claude Code 的 Glob 和 Read 工具能力。

## 需求

### 11.1 核心功能

| 功能 | 描述 |
|------|------|
| 目录树 | 树形展示项目文件结构 |
| 文件预览 | 查看文件内容，支持大文件分页 |
| 文件搜索 | Glob 模式搜索文件 |
| 文件信息 | 查看文件大小、修改时间等元信息 |

### 11.2 API 设计

```json
# 获取目录文件树
GET /api/files/tree?path=/project&depth=2&include_hidden=false

Response: 200 OK
{
  "path": "/home/user/project",
  "name": "project",
  "type": "directory",
  "children": [
    {
      "name": "src",
      "type": "directory",
      "children": [
        {"name": "main.py", "type": "file", "size": 2345, "extension": ".py"}
      ]
    },
    {"name": "README.md", "type": "file", "size": 5120, "extension": ".md"}
  ],
  "metadata": {"total_files": 25, "total_dirs": 8}
}

# 读取文件内容
GET /api/files/read?path=/project/src/main.py&start_line=1&limit=500

Response: 200 OK
{
  "path": "/home/user/project/src/main.py",
  "name": "main.py",
  "size": 2345,
  "totalLines": 89,
  "content": "def main():\n    print(\"hello\")\n...",
  "truncated": false,
  "hasMore": false
}

# 搜索文件
GET /api/files/search?pattern=**/*.py&path=/project&limit=100

Response: 200 OK
{
  "pattern": "**/*.py",
  "matches": [
    {"path": "/project/src/main.py", "name": "main.py", "size": 2345},
    {"path": "/project/src/utils.py", "name": "utils.py", "size": 1024}
  ],
  "total": 25,
  "truncated": false
}

# 获取文件信息
GET /api/files/info?path=/project/src/main.py

Response: 200 OK
{
  "path": "/home/user/project/src/main.py",
  "name": "main.py",
  "type": "file",
  "size": 2345,
  "sizeFormatted": "2.3 KB",
  "extension": ".py",
  "mimeType": "text/x-python",
  "modified": "2026-02-19T10:30:00Z"
}

# Glob 模式查询
POST /api/files/glob
{
  "pattern": "src/**/*.py",
  "path": "/project",
  "limit": 200
}

Response: 200 OK
{
  "pattern": "src/**/*.py",
  "matches": ["src/main.py", "src/utils.py", "src/models/user.py"],
  "count": 3
}
```

### 11.3 UI 设计

- 左侧文件树：树形结构，支持展开/折叠
- 右侧文件预览：行号显示、代码高亮
- 顶部路径导航：面包屑导航
- 搜索框：支持 Glob 模式

### 11.4 优先级

| 功能 | 优先级 |
|------|--------|
| 目录树 API | P0 |
| 文件内容读取 API | P0 |
| 文件树 UI 组件 | P0 |
| 文件预览 UI | P0 |
| 文件搜索 API | P1 |
| 搜索框 UI | P1 |
| 面包屑导航 | P1 |
| 文件图标 | P2 |
| 大文件分页 | P2 |

## 安全考虑

- 路径验证：防止目录遍历攻击
- 大文件限制：单次最多读取 1000 行
- 敏感文件排除：.env, *.pem 等
