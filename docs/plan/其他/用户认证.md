# 用户认证系统

## 概述

为 Claude Code Runner 添加用户认证功能，支持 API Key 和 JWT 两种认证方式。

## 需求

### 1.1 认证方式

| 方式 | 适用场景 | 实现 |
|------|----------|------|
| API Key | 机器对机器通信 | Header: `X-API-Key: <key>` |
| JWT Token | 用户会话 | Header: `Authorization: Bearer <token>` |

### 1.2 用户管理

- **用户注册**: POST /api/auth/register
- **用户登录**: POST /api/auth/login
- **获取当前用户**: GET /api/auth/me
- **修改密码**: PUT /api/auth/password

### 1.3 认证流程

```
用户 -> 注册 -> 登录 -> 获取 Token -> 携带 Token 访问 API
```

## API 设计

### 注册

```json
POST /api/auth/register
{
  "username": "user@example.com",
  "password": "secure_password",
  "name": "John Doe"
}

Response: 201 Created
{
  "user_id": "uuid",
  "username": "user@example.com",
  "name": "John Doe"
}
```

### 登录

```json
POST /api/auth/login
{
  "username": "user@example.com",
  "password": "secure_password"
}

Response: 200 OK
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "bearer",
  "expires_in": 3600
}
```

### 受保护的端点

```json
GET /api/task
Headers: Authorization: Bearer <token>

Response: 200 OK
{
  "success": true,
  ...
}
```

## 技术实现

- 密码使用 bcrypt 哈希存储
- JWT 使用 HS256 算法
- Token 有效期可配置（默认 1 小时）
- 集成 FastAPI 的 Depends 进行认证依赖注入

## 安全要求

- 密码最小长度 8 位
- 密码必须包含字母和数字
- Token 存储在内存中（生产环境使用 Redis）
- 密码不在响应中返回
