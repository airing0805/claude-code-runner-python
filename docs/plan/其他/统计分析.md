# 统计分析

## 概述

提供使用统计、成本分析等可视化功能。

## 需求

### 7.1 统计维度

| 维度 | 指标 |
|------|------|
| 调用统计 | 总请求数、成功/失败数 |
| 成本统计 | 总费用、平均费用、费用趋势 |
| 使用统计 | 最常用工具、会话时长分布 |
| 用户统计 | 活跃用户、API Key 使用情况 |

### 7.2 API 设计

```json
# 获取统计概览
GET /api/stats/overview?period=7d

Response: 200 OK
{
  "total_requests": 1000,
  "successful_requests": 950,
  "failed_requests": 50,
  "total_cost_usd": 25.50,
  "average_cost_per_request": 0.0255,
  "period": "7d"
}

# 获取费用趋势
GET /api/stats/cost?period=30d&granularity=daily

Response: 200 OK
{
  "data": [
    {"date": "2024-01-01", "cost_usd": 1.20},
    {"date": "2024-01-02", "cost_usd": 0.85}
  ]
}

# 获取工具使用统计
GET /api/stats/tools

Response: 200 OK
{
  "tools": [
    {"name": "Read", "count": 500},
    {"name": "Edit", "count": 300},
    {"name": "Write", "count": 150}
  ]
}
```

### 7.3 数据存储

- 使用 SQLite 存储统计数据
- 按天聚合历史数据
- 保留 90 天数据

### 7.4 可视化（Web 界面）

- 仪表盘展示关键指标
- 折线图展示趋势
- 饼图展示工具使用分布
