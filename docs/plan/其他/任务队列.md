# 任务队列

## 概述

支持异步任务提交和后台执行，提高系统吞吐量。

## 需求

### 5.1 任务状态

| 状态 | 说明 |
|------|------|
| pending | 等待处理 |
| running | 正在执行 |
| completed | 执行完成 |
| failed | 执行失败 |
| cancelled | 已取消 |

### 5.2 API 设计

```json
# 提交异步任务
POST /api/tasks
{
  "prompt": "任务描述",
  "working_dir": "/path",
  "callback_url": "https://example.com/callback"
}

Response: 202 Accepted
{
  "task_id": "uuid",
  "status": "pending",
  "created_at": "2024-01-01T00:00:00Z"
}

# 查询任务状态
GET /api/tasks/{task_id}

Response: 200 OK
{
  "task_id": "uuid",
  "status": "completed",
  "result": {...},
  "started_at": "2024-01-01T00:00:01Z",
  "completed_at": "2024-01-01T00:00:06Z"
}

# 取消任务
DELETE /api/tasks/{task_id}

# 列出任务
GET /api/tasks?status=completed&limit=20
```

### 5.3 实现

- 使用 asyncio 队列管理任务
- 后台 worker 消费队列
- 支持优先级队列
- 任务结果存储在内存中（可配置 Redis）

## 配置

- `TASK_QUEUE_MAX_SIZE`: 队列最大长度（默认 100）
- `TASK_WORKER_COUNT`: 并行 worker 数量（默认 3）
- `TASK_TIMEOUT`: 任务超时时间（默认 30 分钟）
