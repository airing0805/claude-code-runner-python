# v0.3.7 - 插件管理技术设计

## 1. API 接口设计

### 1.1 获取插件列表

```
GET /api/claude/plugins
```

**响应示例**：
```json
{
  "plugins": [
    {
      "id": "plugin-code-review",
      "name": "Code Review",
      "description": "自动代码审查插件",
      "version": "1.0.0",
      "author": "Claude Team",
      "is_enabled": true,
      "is_builtin": true
    }
  ]
}
```

### 1.2 获取插件详情

```
GET /api/claude/plugins/{plugin_id}
```

### 1.3 启用插件

```
POST /api/claude/plugins/{plugin_id}/enable
```

### 1.4 禁用插件

```
POST /api/claude/plugins/{plugin_id}/disable
```

## 2. 数据结构设计

### 2.1 Plugin

```python
from pydantic import BaseModel

class Plugin(BaseModel):
    id: str
    name: str
    description: str
    version: str
    author: str
    is_enabled: bool
    is_builtin: bool
```

## 3. 后端实现

### 3.1 路由设计

在 `app/routers/claude.py` 中添加：

```python
@router.get("/plugins", response_model=PluginsDoc)
async def get_plugins():
    """获取插件列表"""
    ...

@router.get("/plugins/{plugin_id}", response_model=Plugin)
async def get_plugin(plugin_id: str):
    """获取插件详情"""
    ...

@router.post("/plugins/{plugin_id}/enable")
async def enable_plugin(plugin_id: str):
    """启用插件"""
    ...

@router.post("/plugins/{plugin_id}/disable")
async def disable_plugin(plugin_id: str):
    """禁用插件"""
    ...
```

### 3.2 插件管理

```python
from pathlib import Path

class PluginManager:
    """插件管理器"""

    PLUGINS_DIR = Path.home() / ".claude" / "plugins"

    def get_plugins(self) -> list[Plugin]:
        """获取插件列表"""
        ...

    def enable_plugin(self, plugin_id: str):
        """启用插件"""
        ...

    def disable_plugin(self, plugin_id: str):
        """禁用插件"""
        ...
```

## 4. 前端设计

### 4.1 页面结构

```
┌─────────────────────────────────────────────────────────────┐
│  插件管理                                                    │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 名称          │ 描述              │ 状态 │ 操作      │   │
│  ├───────────────┼───────────────────┼──────┼──────────┤   │
│  │ Code Review   │ 自动代码审查      │ 启用 │ [禁用]   │   │
│  │ Commit Helper │ Git 提交助手      │ 启用 │ [禁用]   │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## 5. 关键文件

| 文件 | 操作 |
|------|------|
| `app/routers/claude.py` | 修改 - 添加插件相关端点 |
| `app/claude/plugins_manager.py` | 新建 |
