<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Runner</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🤖</text></svg>">
    <link rel="stylesheet" href="/static/style.css">

    <!-- v0.5.2: Markdown 渲染库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- v0.5.7: Diff 可视化库 -->
    <script src="https://cdn.jsdelivr.net/npm/diff@5.1.0/dist/diff.min.js"></script>
</head>
<body>
    <div class="app-layout">
        <!-- 左侧菜单栏 -->
        <nav class="nav-menu" id="nav-menu">
            <div class="nav-header">
                <span class="nav-logo">🤖</span>
                <span class="nav-title">Claude Code</span>
            </div>

            <div class="nav-items">
                <div class="nav-item active" data-view="current-session">
                    <span class="nav-icon">💬</span>
                    <span class="nav-text">当前会话</span>
                </div>
                <div class="nav-item" data-view="history">
                    <span class="nav-icon">📜</span>
                    <span class="nav-text">历史记录</span>
                </div>
                <div class="nav-item" data-view="examples">
                    <span class="nav-icon">📋</span>
                    <span class="nav-text">示例任务</span>
                </div>
                <div class="nav-item" data-view="claude-status">
                    <span class="nav-icon">⚙️</span>
                    <span class="nav-text">Claude 状态</span>
                </div>
                <div class="nav-item" data-view="claude-docs">
                    <span class="nav-icon">📚</span>
                    <span class="nav-text">Claude 文档</span>
                </div>
                <div class="nav-item" data-view="agent-monitor">
                    <span class="nav-icon">🤖</span>
                    <span class="nav-text">Agent 监控</span>
                </div>
                <div class="nav-item" data-view="skills">
                    <span class="nav-icon">🧩</span>
                    <span class="nav-text">技能管理</span>
                </div>
                <div class="nav-item" data-view="mcp-servers">
                    <span class="nav-icon">🔌</span>
                    <span class="nav-text">MCP 服务器</span>
                </div>
                <div class="nav-item" data-view="plugins">
                    <span class="nav-icon">🧩</span>
                    <span class="nav-text">插件管理</span>
                </div>
                <div class="nav-item" data-view="hooks-config">
                    <span class="nav-icon">⚓</span>
                    <span class="nav-text">钩子配置</span>
                </div>
                <div class="nav-item" data-view="scheduler">
                    <span class="nav-icon">📋</span>
                    <span class="nav-text">任务调度</span>
                </div>
            </div>

            <div class="nav-footer">
                <button class="nav-toggle" id="nav-toggle" title="收起/展开菜单">◀</button>
            </div>
        </nav>

        <!-- 右侧内容区 -->
        <main class="main-content">
            <!-- 当前会话视图 -->
            <div class="view-panel active" id="view-current-session">
                <div class="session-layout">
                    <!-- 顶部：标题栏 -->
                    <div class="session-header">
                        <button class="menu-toggle" id="menu-toggle" title="显示/隐藏菜单">☰</button>
                        <div class="session-title">💬 当前会话</div>
                    </div>

                    <!-- 标签页栏 -->
                    <div class="tabs-bar" id="tabs-bar">
                        <button class="tab-item active" data-tab="new" onclick="if(window.runner) Tabs.switchToTab(window.runner, 'new')">
                            <span class="tab-icon">➕</span>
                            <span class="tab-title">新任务</span>
                        </button>
                    </div>

                    <!-- 信息栏 -->
                    <div class="session-info-bar">
                        <span class="info-item">
                            <span class="info-label">工作目录</span>
                            <input type="text" id="working-dir" class="info-input info-input-working-dir" list="working-dir-list" value="{{ working_dir }}" title="选择或输入工作目录" placeholder="选择或输入路径">
                            <datalist id="working-dir-list"></datalist>
                        </span>
                        <span class="info-item">
                            <span class="info-label">会话ID</span>
                            <input type="text" id="resume" placeholder="新会话" class="info-input info-input-session" readonly title="会话ID">
                        </span>
                        <span class="info-item">
                            <span class="info-label">工具权限</span>
                            <div class="tools-multiselect">
                                <div class="tools-select-btn" id="tools-select-btn">
                                    <span class="selected-text">选择工具...</span>
                                    <span class="selected-count" style="display: none;">0</span>
                                    <span>▼</span>
                                </div>
                                <div class="tools-dropdown" id="tools-dropdown">
                                    <!-- 工具选项将由 JavaScript 动态生成 -->
                                </div>
                            </div>
                            <input type="hidden" id="tools" value="Read,Write,Edit,Bash,Glob,Grep">
                        </span>
                        <span class="info-item info-item-toggle">
                            <label class="checkbox-label">
                                <input type="checkbox" id="continue-conversation">
                                <span>继续会话</span>
                            </label>
                        </span>
                        <span class="info-item info-item-right">
                            <button id="new-session-btn" class="btn btn-new-session" title="创建新会话">➕ 新会话</button>
                        </span>
                    </div>

                    <!-- 中间：会话过程显示区 -->
                    <!-- v0.5.5 SSE 连接状态指示器 -->
                    <div class="connection-indicator" id="connection-indicator" style="display: none;">
                        <span class="connection-status-dot">🟢</span>
                        <span class="connection-status-text">已连接</span>
                        <span class="connection-retry-info" style="display: none;"></span>
                        <button class="connection-reconnect-btn" style="display: none;" title="手动重连">🔄 重连</button>
                    </div>
                    <div class="session-output" id="output">
                        <div class="output-placeholder">执行任务后，输出将显示在这里...</div>
                    </div>

                    <!-- 统计信息（悬浮显示） -->
                    <div class="stats-floating" id="task-stats-floating" style="display: none;">
                        <span class="stat-item" id="stat-status-wrapper">
                            <span class="stat-label">状态</span>
                            <span class="stat-value" id="stat-status">-</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label">耗时</span>
                            <span class="stat-value" id="stat-duration">-</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label">费用</span>
                            <span class="stat-value" id="stat-cost">-</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label">会话ID</span>
                            <span class="stat-value stat-session" id="stat-session" title="点击复制">-</span>
                        </span>
                    </div>

                    <!-- 底部：对话输入区 -->
                    <div class="session-input-container">
                        <div class="session-input">
                            <textarea id="prompt" rows="2" placeholder="描述你希望 Claude Code 执行的任务... (Enter 发送, Ctrl+Enter 换行)"></textarea>
                        </div>
                        <div class="input-toolbar">
                            <div class="toolbar-left">
                                <div class="permission-select">
                                    <label class="permission-label">权限模式</label>
                                    <select id="permission-mode" class="permission-dropdown">
                                        <option value="default">default - 默认</option>
                                        <option value="acceptEdits">acceptEdits - 接受编辑</option>
                                        <option value="plan">plan - 计划模式</option>
                                        <option value="bypassPermissions">bypassPermissions - 绕过权限</option>
                                    </select>
                                </div>
                            </div>
                            <div class="toolbar-right">
                                <button id="send-btn" class="btn btn-primary">➤ 发送</button>
                                <button id="stop-btn" class="btn btn-stop" style="display: none;">⏹ 停止</button>
                                <button id="clear-btn" class="btn btn-secondary">🗑 清空</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 历史记录视图 -->
            <div class="view-panel" id="view-history">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-history" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">📜 历史记录</div>
                        <div class="page-subtitle">查看和管理历史会话</div>
                    </div>

                    <div class="page-body history-body">
                        <!-- 项目列表 -->
                        <div class="history-section" id="history-projects">
                            <div class="history-header">
                                <h2>📁 项目列表</h2>
                            </div>
                            <div class="project-list-container">
                                <div class="project-list" id="project-list">
                                    <div class="loading-placeholder">加载中...</div>
                                </div>
                            </div>
                            <div class="pagination-bar" id="projects-pagination">
                                <!-- 项目分页控件 -->
                            </div>
                        </div>

                        <!-- 会话列表 (选择项目后显示) -->
                        <div class="history-section" id="history-sessions" style="display: none;">
                            <div class="history-header">
                                <button class="back-btn" id="back-to-projects">← 返回项目列表</button>
                                <h2 id="current-project-title">会话列表</h2>
                            </div>
                            <div class="session-list-container">
                                <div class="session-list" id="session-list">
                                    <div class="loading-placeholder">加载中...</div>
                                </div>
                            </div>
                            <div class="pagination-bar" id="sessions-pagination">
                                <!-- 会话分页控件 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 示例任务视图 -->
            <div class="view-panel" id="view-examples">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-examples" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">📋 示例任务</div>
                        <div class="page-subtitle">点击示例快速填充任务描述</div>
                    </div>

                    <div class="page-body examples-body">
                        <p class="examples-intro">点击下方示例按钮，将自动跳转到当前会话并填充任务描述。</p>
                        <div class="example-grid">
                            <button class="btn btn-example-large" data-prompt="列出当前目录下所有 Python 文件">
                                <span class="example-icon">📄</span>
                                <span class="example-title">列出 Python 文件</span>
                                <span class="example-desc">查找当前目录中的所有 .py 文件</span>
                            </button>
                            <button class="btn btn-example-large" data-prompt="阅读 main.py 文件并总结其功能">
                                <span class="example-icon">📖</span>
                                <span class="example-title">总结代码功能</span>
                                <span class="example-desc">阅读代码并生成功能摘要</span>
                            </button>
                            <button class="btn btn-example-large" data-prompt="检查代码中的 TODO 注释">
                                <span class="example-icon">🔍</span>
                                <span class="example-title">查找 TODO</span>
                                <span class="example-desc">扫描项目中所有待办事项</span>
                            </button>
                            <button class="btn btn-example-large" data-prompt="分析项目结构并生成 README.md">
                                <span class="example-icon">📝</span>
                                <span class="example-title">生成 README</span>
                                <span class="example-desc">自动分析并生成项目文档</span>
                            </button>
                            <button class="btn btn-example-large" data-prompt="检查代码中的安全问题">
                                <span class="example-icon">🔒</span>
                                <span class="example-title">安全检查</span>
                                <span class="example-desc">扫描代码中的安全漏洞</span>
                            </button>
                            <button class="btn btn-example-large" data-prompt="优化代码性能并给出建议">
                                <span class="example-icon">⚡</span>
                                <span class="example-title">性能优化</span>
                                <span class="example-desc">分析代码并提供优化建议</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Claude 状态视图 -->
            <div class="view-panel" id="view-claude-status">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-claude-status" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">⚙️ Claude 状态</div>
                        <div class="page-subtitle">查看 Claude Code 运行状态和配置</div>
                    </div>

                    <div class="page-body claude-status-body">
                        <!-- 版本信息区块 -->
                        <div class="status-section" id="version-section">
                            <div class="status-section-header">
                                <h2>📊 版本信息</h2>
                            </div>
                            <div class="status-section-content">
                                <div class="status-grid">
                                    <div class="status-item">
                                        <span class="status-label">CLI 版本</span>
                                        <span class="status-value" id="cli-version">-</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">SDK 版本</span>
                                        <span class="status-value" id="sdk-version">-</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">操作系统</span>
                                        <span class="status-value" id="os-info">-</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">Python 版本</span>
                                        <span class="status-value" id="python-version">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 环境变量区块 -->
                        <div class="status-section" id="env-section">
                            <div class="status-section-header">
                                <h2>🔧 环境变量</h2>
                                <button class="btn btn-small" id="refresh-env-btn">🔄 刷新</button>
                            </div>
                            <div class="status-section-content">
                                <div class="env-list" id="env-list">
                                    <div class="loading-placeholder">加载中...</div>
                                </div>
                            </div>
                        </div>

                        <!-- 配置信息区块 -->
                        <div class="status-section" id="config-section">
                            <div class="status-section-header">
                                <h2>📁 配置信息</h2>
                            </div>
                            <div class="status-section-content">
                                <div class="status-grid">
                                    <div class="status-item status-item-full">
                                        <span class="status-label">工作目录</span>
                                        <span class="status-value" id="working-dir-config">-</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">权限模式</span>
                                        <span class="status-value" id="permission-mode">-</span>
                                    </div>
                                    <div class="status-item status-item-full">
                                        <span class="status-label">可用工具</span>
                                        <span class="status-value" id="allowed-tools">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 工具使用统计区块 -->
                        <div class="status-section" id="tools-usage-section">
                            <div class="status-section-header">
                                <h2>📈 工具使用统计</h2>
                            </div>
                            <div class="status-section-content">
                                <div class="loading-placeholder">加载中...</div>
                            </div>
                        </div>

                        <!-- 权限模式说明区块 -->
                        <div class="status-section" id="permission-modes-section">
                            <div class="status-section-header">
                                <h2>🔐 权限模式说明</h2>
                            </div>
                            <div class="status-section-content">
                                <div class="loading-placeholder">加载中...</div>
                            </div>
                        </div>

                        <!-- 可用工具列表区块 -->
                        <div class="status-section" id="tools-list-section">
                            <div class="status-section-header">
                                <h2>🛠️ 可用工具列表</h2>
                            </div>
                            <div class="status-section-content">
                                <div class="loading-placeholder">加载中...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Claude 文档视图 -->
            <div class="view-panel" id="view-claude-docs">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-claude-docs" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">📚 Claude Code 文档</div>
                        <div class="page-subtitle">工具详解、代理类型、内置命令和最佳实践</div>
                    </div>

                    <div class="page-body claude-docs-body">
                        <!-- Tab 导航 -->
                        <div class="docs-tabs">
                            <button class="docs-tab active" data-tab="tools-docs">工具详解</button>
                            <button class="docs-tab" data-tab="agents-docs">代理类型</button>
                            <button class="docs-tab" data-tab="commands-docs">内置命令</button>
                            <button class="docs-tab" data-tab="best-practices-docs">最佳实践</button>
                        </div>
                        <!-- Tab 内容 -->
                        <div class="docs-tab-content">
                            <div class="docs-tab-pane active" id="tools-docs">
                                <div class="docs-list" id="tools-docs-list">
                                    <div class="loading-placeholder">加载中...</div>
                                </div>
                            </div>
                            <div class="docs-tab-pane" id="agents-docs">
                                <div class="docs-list" id="agents-docs-list">
                                    <div class="loading-placeholder">加载中...</div>
                                </div>
                            </div>
                            <div class="docs-tab-pane" id="commands-docs">
                                <div class="docs-list" id="commands-docs-list">
                                    <div class="loading-placeholder">加载中...</div>
                                </div>
                            </div>
                            <div class="docs-tab-pane" id="best-practices-docs">
                                <div class="docs-list" id="best-practices-docs-list">
                                    <div class="loading-placeholder">加载中...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent 监控视图 -->
            <div class="view-panel" id="view-agent-monitor">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-agent-monitor" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">🤖 Agent 监控</div>
                        <div class="page-subtitle">监控和管理子代理运行状态</div>
                    </div>

                    <div class="page-body agent-monitor-body">
                        <!-- 统计信息 -->
                        <div class="agent-stats">
                            <div class="agent-stat-card">
                                <div class="agent-stat-value" id="running-agent-count">0</div>
                                <div class="agent-stat-label">运行中</div>
                            </div>
                        </div>

                        <!-- 过滤栏 -->
                        <div class="agent-filter-bar">
                            <label>状态筛选：</label>
                            <select id="agent-status-filter">
                                <option value="all">全部</option>
                                <option value="running">运行中</option>
                                <option value="completed">已完成</option>
                                <option value="terminated">已终止</option>
                                <option value="failed">失败</option>
                            </select>
                            <button class="btn btn-small" id="refresh-agents-btn">🔄 刷新</button>
                            <button class="btn btn-small" id="create-test-agent-btn">➕ 创建测试代理</button>
                        </div>

                        <!-- 代理列表 -->
                        <div class="agent-list" id="agent-list">
                            <div class="loading-placeholder">加载中...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 技能管理视图 -->
            <div class="view-panel" id="view-skills">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-skills" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">🧩 技能管理</div>
                        <div class="page-subtitle">管理 Claude Code 技能系统</div>
                    </div>

                    <div class="page-body skills-body">
                        <!-- 分类筛选 -->
                        <div class="skills-filter-bar">
                            <button class="btn btn-small" id="refresh-skills-btn">🔄 刷新</button>
                        </div>

                        <!-- 分类标签 -->
                        <div id="skill-categories"></div>

                        <!-- 技能列表 -->
                        <div class="skill-list" id="skill-list">
                            <div class="loading-placeholder">加载中...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MCP 服务器管理视图 -->
            <div class="view-panel" id="view-mcp-servers">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-mcp-servers" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">🔌 MCP 服务器管理</div>
                        <div class="page-subtitle">管理 Claude Code MCP 服务器连接</div>
                    </div>

                    <div class="page-body mcp-servers-body">
                        <!-- 操作栏 -->
                        <div class="mcp-actions-bar">
                            <button class="btn btn-small" id="refresh-mcp-servers-btn">🔄 刷新</button>
                            <button class="btn btn-small" id="add-mcp-server-menu-btn">➕ 添加服务器</button>
                        </div>

                        <!-- 服务器列表 -->
                        <div class="mcp-server-list-container" id="mcp-server-list-container">
                            <div class="loading-placeholder">加载中...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 插件管理视图 (v0.3.7) -->
            <div class="view-panel" id="view-plugins">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-plugins" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">🧩 插件管理</div>
                        <div class="page-subtitle">管理 Claude Code 插件</div>
                    </div>

                    <div class="page-body plugins-body">
                        <!-- 操作栏 -->
                        <div class="plugins-actions-bar">
                            <button class="btn btn-small" id="refresh-plugins-btn">🔄 刷新</button>
                        </div>

                        <!-- 插件列表 -->
                        <div class="plugin-list-container" id="plugin-list-view">
                            <div class="loading-placeholder">加载中...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 钩子配置视图 (v0.3.8) -->
            <div class="view-panel" id="view-hooks-config">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-hooks-config" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">⚓ 钩子配置</div>
                        <div class="page-subtitle">管理 Claude Code 钩子配置</div>
                    </div>

                    <div class="page-body hooks-config-body">
                        <!-- 操作栏 -->
                        <div class="hooks-actions-bar">
                            <button class="btn btn-small" id="refresh-hooks-btn">🔄 刷新</button>
                            <button class="btn btn-small" id="add-hook-btn">➕ 添加钩子</button>
                        </div>

                        <!-- 钩子类型说明 -->
                        <div id="hook-types-info">
                            <div class="loading-placeholder">加载中...</div>
                        </div>

                        <!-- 钩子列表 -->
                        <div class="hook-list-container" id="hook-list">
                            <div class="loading-placeholder">加载中...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 任务调度视图 (v0.6.4) -->
            <div class="view-panel" id="view-scheduler">
                <div class="page-container">
                    <div class="page-header">
                        <button class="menu-toggle" id="menu-toggle-scheduler" title="显示/隐藏菜单">☰</button>
                        <div class="page-title">📋 任务调度</div>
                        <div class="page-subtitle">管理任务队列和定时任务</div>
                    </div>

                    <!-- 调度器状态栏 -->
                    <div class="scheduler-status-bar" id="scheduler-status-bar">
                        <div class="scheduler-status-left">
                            <span class="scheduler-status-icon" id="scheduler-status-icon">⏸</span>
                            <span class="scheduler-status-text" id="scheduler-status-text">已停止</span>
                        </div>
                        <div class="scheduler-stats">
                            <span class="scheduler-stat">
                                <span class="stat-value" id="scheduler-queue-count">0</span>
                                <span class="stat-label">队列</span>
                            </span>
                            <span class="scheduler-stat">
                                <span class="stat-value" id="scheduler-scheduled-count">0</span>
                                <span class="stat-label">定时</span>
                            </span>
                            <span class="scheduler-stat">
                                <span class="stat-value" id="scheduler-running-count">0</span>
                                <span class="stat-label">运行</span>
                            </span>
                        </div>
                        <div class="scheduler-actions">
                            <button class="btn btn-small" id="scheduler-start-btn" title="启动调度器">▶ 启动</button>
                            <button class="btn btn-small" id="scheduler-stop-btn" style="display:none" title="停止调度器">⏹ 停止</button>
                            <button class="btn btn-small" id="scheduler-refresh-btn" title="刷新数据">🔄 刷新</button>
                        </div>
                    </div>

                    <!-- 标签页导航 -->
                    <div class="scheduler-tabs" id="scheduler-tabs">
                        <button class="scheduler-tab active" data-tab="queue">
                            <span class="tab-icon">📥</span>
                            <span class="tab-text">任务队列</span>
                        </button>
                        <button class="scheduler-tab" data-tab="scheduled">
                            <span class="tab-icon">⏰</span>
                            <span class="tab-text">定时任务</span>
                        </button>
                        <button class="scheduler-tab" data-tab="running">
                            <span class="tab-icon">🔄</span>
                            <span class="tab-text">运行中</span>
                        </button>
                        <button class="scheduler-tab" data-tab="completed">
                            <span class="tab-icon">✅</span>
                            <span class="tab-text">已完成</span>
                        </button>
                        <button class="scheduler-tab" data-tab="failed">
                            <span class="tab-icon">❌</span>
                            <span class="tab-text">失败</span>
                        </button>
                    </div>

                    <!-- 内容区域 -->
                    <div class="scheduler-content" id="scheduler-content">
                        <!-- 任务队列标签页 -->
                        <div class="scheduler-tab-pane active" id="scheduler-tab-queue">
                            <div class="scheduler-actions-bar">
                                <button class="btn btn-primary" id="scheduler-add-task-btn">➕ 添加任务</button>
                                <button class="btn btn-secondary" id="scheduler-clear-queue-btn">🗑 清空队列</button>
                            </div>
                            <div class="scheduler-list" id="scheduler-queue-list">
                                <div class="loading-placeholder">加载中...</div>
                            </div>
                        </div>

                        <!-- 定时任务标签页 -->
                        <div class="scheduler-tab-pane" id="scheduler-tab-scheduled">
                            <div class="scheduler-actions-bar">
                                <button class="btn btn-primary" id="scheduler-add-scheduled-btn">➕ 添加定时任务</button>
                            </div>
                            <div class="scheduler-list" id="scheduler-scheduled-list">
                                <div class="loading-placeholder">加载中...</div>
                            </div>
                        </div>

                        <!-- 运行中标签页 -->
                        <div class="scheduler-tab-pane" id="scheduler-tab-running">
                            <div class="scheduler-list" id="scheduler-running-list">
                                <div class="loading-placeholder">加载中...</div>
                            </div>
                        </div>

                        <!-- 已完成标签页 -->
                        <div class="scheduler-tab-pane" id="scheduler-tab-completed">
                            <div class="scheduler-list" id="scheduler-completed-list">
                                <div class="loading-placeholder">加载中...</div>
                            </div>
                            <div class="pagination-bar" id="completed-pagination"></div>
                        </div>

                        <!-- 失败标签页 -->
                        <div class="scheduler-tab-pane" id="scheduler-tab-failed">
                            <div class="scheduler-list" id="scheduler-failed-list">
                                <div class="loading-placeholder">加载中...</div>
                            </div>
                            <div class="pagination-bar" id="failed-pagination"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MCP 服务器对话框 -->
    <div class="dialog-overlay" id="mcp-dialog">
        <div class="dialog-content">
            <div class="dialog-header">
                <h2 class="dialog-title" id="mcp-dialog-title">添加 MCP 服务器</h2>
                <button class="dialog-close" id="close-mcp-dialog">×</button>
            </div>

            <div class="form-group">
                <label class="form-label">服务器名称</label>
                <input type="text" class="form-input" id="mcp-server-name" placeholder="例如：GitHub">
            </div>

            <div class="form-group">
                <label class="form-label">连接类型</label>
                <select class="form-input" id="mcp-connection-type">
                    <option value="stdio">stdio (本地命令)</option>
                    <option value="http">http/sse (远程服务)</option>
                </select>
            </div>

            <!-- stdio 配置 -->
            <div class="config-section" id="stdio-config">
                <div class="form-group">
                    <label class="form-label">命令</label>
                    <input type="text" class="form-input" id="mcp-command" placeholder="例如：npx">
                </div>
                <div class="form-group">
                    <label class="form-label">参数 (空格分隔)</label>
                    <input type="text" class="form-input" id="mcp-args" placeholder="例如：-y @modelcontextprotocol/server-github">
                </div>
            </div>

            <!-- http 配置 -->
            <div class="config-section" id="http-config" style="display: none;">
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="text" class="form-input" id="mcp-url" placeholder="例如：http://localhost:3000">
                </div>
            </div>

            <div class="form-group">
                <label class="form-checkbox">
                    <input type="checkbox" id="mcp-enabled" checked>
                    <span>启用服务器</span>
                </label>
            </div>

            <div class="form-actions">
                <button class="btn-secondary" id="cancel-mcp-dialog-btn">取消</button>
                <button class="btn-primary" id="save-mcp-server-btn">保存</button>
            </div>
        </div>
    </div>

    <!-- Agent 详情对话框 -->
    <div class="dialog-overlay" id="agent-detail-dialog">
        <div class="agent-detail-content">
            <div class="dialog-header">
                <h2 class="dialog-title">代理详情</h2>
                <button class="dialog-close" id="close-agent-detail-dialog">×</button>
            </div>

            <div class="detail-section">
                <div class="detail-section-title">任务描述</div>
                <div class="detail-section-content" id="detail-agent-prompt">-</div>
            </div>

            <div class="status-grid">
                <div class="status-item">
                    <span class="status-label">状态</span>
                    <span class="status-value" id="detail-agent-status">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">进度</span>
                    <span class="status-value" id="detail-agent-progress">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">开始时间</span>
                    <span class="status-value" id="detail-agent-started">-</span>
                </div>
                <div class="status-item">
                    <span class="status-label">结束时间</span>
                    <span class="status-value" id="detail-agent-ended">-</span>
                </div>
            </div>

            <div class="detail-section">
                <div class="detail-section-title">工具使用</div>
                <div class="detail-section-content" id="detail-agent-tools">
                    <span class="empty-text">无</span>
                </div>
            </div>

            <div class="detail-section">
                <div class="detail-section-title">文件变更</div>
                <div class="detail-section-content" id="detail-agent-files">
                    <span class="empty-text">无</span>
                </div>
            </div>

            <div class="detail-section">
                <div class="detail-section-title">执行日志</div>
                <div class="detail-section-content" id="detail-agent-logs">
                    <span class="empty-text">暂无日志</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 技能详情对话框 -->
    <div class="dialog-overlay" id="skill-detail-dialog">
        <div class="dialog-content">
            <div class="dialog-header">
                <h2 class="dialog-title">技能详情</h2>
                <button class="dialog-close" id="close-skill-detail">×</button>
            </div>

            <div id="skill-detail-content">
                <div class="loading-placeholder">加载中...</div>
            </div>
        </div>
    </div>

    <!-- 钩子配置对话框 -->
    <div class="dialog-overlay" id="hook-dialog">
        <div class="dialog-content">
            <div class="dialog-header">
                <h2 class="dialog-title" id="hook-dialog-title">添加钩子</h2>
                <button class="dialog-close" id="close-hook-dialog">×</button>
            </div>

            <input type="hidden" id="hook-id">

            <div class="form-group">
                <label class="form-label">钩子名称</label>
                <input type="text" class="form-input" id="hook-name" placeholder="例如：安全检查">
            </div>

            <div class="form-group">
                <label class="form-label">钩子类型</label>
                <select class="form-input" id="hook-type">
                    <!-- 钩子类型将通过JavaScript动态填充 -->
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">触发工具 (留空表示所有工具)</label>
                <input type="text" class="form-input" id="hook-tools" placeholder="例如：Bash,Write (逗号分隔)">
            </div>

            <div class="form-group">
                <label class="form-label">操作</label>
                <select class="form-input" id="hook-action">
                    <option value="allow">允许 - 正常执行</option>
                    <option value="block">阻止 - 阻止执行</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-checkbox">
                    <input type="checkbox" id="hook-notification">
                    <span>启用通知</span>
                </label>
            </div>

            <div class="form-group">
                <label class="form-checkbox">
                    <input type="checkbox" id="hook-enabled" checked>
                    <span>启用钩子</span>
                </label>
            </div>

            <div class="form-actions">
                <button class="btn-secondary" id="cancel-hook-dialog-btn">取消</button>
                <button class="btn-primary" id="save-hook-btn">保存</button>
            </div>
        </div>
    </div>

    <!-- 添加任务对话框 (v0.6.4) -->
    <div class="dialog-overlay" id="add-task-dialog">
        <div class="dialog-content">
            <div class="dialog-header">
                <h2 class="dialog-title">添加任务到队列</h2>
                <button class="dialog-close" id="close-add-task-dialog">×</button>
            </div>

            <div class="form-group">
                <label class="form-label">任务描述 <span class="required">*</span></label>
                <textarea class="form-input" id="task-prompt" rows="4" placeholder="描述你希望 Claude Code 执行的任务..." required></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">工作目录</label>
                <input type="text" class="form-input" id="task-working-dir" placeholder="留空使用默认目录">
            </div>

            <div class="form-group">
                <label class="form-label">超时时间（秒）</label>
                <input type="number" class="form-input" id="task-timeout" value="600" min="60" max="3600">
            </div>

            <div class="form-group">
                <label class="form-label">工具权限</label>
                <div class="tools-multiselect" id="task-tools-multiselect">
                    <div class="tools-select-btn" id="task-tools-select-btn">
                        <span class="selected-text">选择工具...</span>
                        <span class="selected-count" style="display: none;">0</span>
                        <span>▼</span>
                    </div>
                    <div class="tools-dropdown" id="task-tools-dropdown"></div>
                </div>
                <input type="hidden" id="task-tools" value="Read,Write,Edit,Bash,Glob,Grep">
            </div>

            <div class="form-group">
                <label class="form-checkbox">
                    <input type="checkbox" id="task-auto-approve">
                    <span>自动批准工具操作</span>
                </label>
            </div>

            <div class="form-actions">
                <button class="btn-secondary" id="cancel-add-task-btn">取消</button>
                <button class="btn-primary" id="confirm-add-task-btn">添加</button>
            </div>
        </div>
    </div>

    <!-- 添加定时任务对话框 (v0.6.4) -->
    <div class="dialog-overlay" id="add-scheduled-dialog">
        <div class="dialog-content">
            <div class="dialog-header">
                <h2 class="dialog-title" id="scheduled-dialog-title">添加定时任务</h2>
                <button class="dialog-close" id="close-add-scheduled-dialog">×</button>
            </div>

            <input type="hidden" id="scheduled-task-id">

            <div class="form-group">
                <label class="form-label">任务名称 <span class="required">*</span></label>
                <input type="text" class="form-input" id="scheduled-name" placeholder="例如：每日代码审查" required>
            </div>

            <div class="form-group">
                <label class="form-label">Cron 表达式 <span class="required">*</span></label>
                <div class="cron-input-group">
                    <input type="text" class="form-input" id="scheduled-cron" placeholder="0 9 * * *" required>
                    <button class="btn btn-small" id="cron-help-btn" title="查看 Cron 表达式帮助">?</button>
                </div>
                <div class="cron-preview" id="cron-preview">
                    <span class="cron-preview-label">下次执行：</span>
                    <span class="cron-preview-value" id="cron-next-run">-</span>
                </div>
                <div class="cron-error" id="cron-error" style="display:none;"></div>
            </div>

            <div class="form-group">
                <label class="form-label">任务描述 <span class="required">*</span></label>
                <textarea class="form-input" id="scheduled-prompt" rows="4" placeholder="描述你希望 Claude Code 执行的任务..." required></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">工作目录</label>
                <input type="text" class="form-input" id="scheduled-working-dir" placeholder="留空使用默认目录">
            </div>

            <div class="form-group">
                <label class="form-label">超时时间（秒）</label>
                <input type="number" class="form-input" id="scheduled-timeout" value="600" min="60" max="3600">
            </div>

            <div class="form-group">
                <label class="form-label">工具权限</label>
                <div class="tools-multiselect" id="scheduled-tools-multiselect">
                    <div class="tools-select-btn" id="scheduled-tools-select-btn">
                        <span class="selected-text">选择工具...</span>
                        <span class="selected-count" style="display: none;">0</span>
                        <span>▼</span>
                    </div>
                    <div class="tools-dropdown" id="scheduled-tools-dropdown"></div>
                </div>
                <input type="hidden" id="scheduled-tools" value="Read,Write,Edit,Bash,Glob,Grep">
            </div>

            <div class="form-group">
                <label class="form-checkbox">
                    <input type="checkbox" id="scheduled-auto-approve">
                    <span>自动批准工具操作</span>
                </label>
            </div>

            <div class="form-group">
                <label class="form-checkbox">
                    <input type="checkbox" id="scheduled-enabled" checked>
                    <span>启用定时任务</span>
                </label>
            </div>

            <div class="form-actions">
                <button class="btn-secondary" id="cancel-add-scheduled-btn">取消</button>
                <button class="btn-primary" id="confirm-add-scheduled-btn">保存</button>
            </div>
        </div>
    </div>

    <!-- 任务详情对话框 (v0.6.4) -->
    <div class="dialog-overlay" id="task-detail-dialog">
        <div class="dialog-content dialog-content-large">
            <div class="dialog-header">
                <h2 class="dialog-title">任务详情</h2>
                <button class="dialog-close" id="close-task-detail-dialog">×</button>
            </div>

            <div class="task-detail-content">
                <div class="detail-section">
                    <div class="detail-section-title">任务描述</div>
                    <div class="detail-section-content" id="detail-task-prompt">-</div>
                </div>

                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">状态</span>
                        <span class="status-value" id="detail-task-status">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">开始时间</span>
                        <span class="status-value" id="detail-task-started">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">结束时间</span>
                        <span class="status-value" id="detail-task-ended">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">耗时</span>
                        <span class="status-value" id="detail-task-duration">-</span>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">工作目录</div>
                    <div class="detail-section-content" id="detail-task-working-dir">-</div>
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">工具使用</div>
                    <div class="detail-section-content" id="detail-task-tools">
                        <span class="empty-text">无</span>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">文件变更</div>
                    <div class="detail-section-content" id="detail-task-files">
                        <span class="empty-text">无</span>
                    </div>
                </div>

                <div class="detail-section collapsible">
                    <div class="detail-section-header" id="detail-output-toggle">
                        <div class="detail-section-title">输出日志</div>
                        <span class="collapse-icon">▼</span>
                    </div>
                    <div class="detail-section-content collapsible-content" id="detail-task-output">
                        <span class="empty-text">暂无日志</span>
                    </div>
                </div>

                <div class="detail-section" id="detail-error-section" style="display:none;">
                    <div class="detail-section-title error-title">错误信息</div>
                    <div class="detail-section-content error-content" id="detail-task-error">-</div>
                </div>
            </div>

            <div class="form-actions">
                <button class="btn-secondary" id="copy-task-log-btn">📋 复制日志</button>
                <button class="btn-primary" id="close-detail-btn">关闭</button>
            </div>
        </div>
    </div>

    <!-- Cron 帮助对话框 (v0.6.4) -->
    <div class="dialog-overlay" id="cron-help-dialog">
        <div class="dialog-content">
            <div class="dialog-header">
                <h2 class="dialog-title">Cron 表达式帮助</h2>
                <button class="dialog-close" id="close-cron-help-dialog">×</button>
            </div>

            <div class="cron-help-content">
                <p class="cron-help-intro">Cron 表达式用于定义定时任务的执行时间。</p>

                <div class="cron-format-section">
                    <h3>格式说明</h3>
                    <code class="cron-format">分 时 日 月 周</code>
                    <div class="cron-field-desc">
                        <span>分 (0-59)</span>
                        <span>时 (0-23)</span>
                        <span>日 (1-31)</span>
                        <span>月 (1-12)</span>
                        <span>周 (0-6, 0=周日)</span>
                    </div>
                </div>

                <div class="cron-examples-section">
                    <h3>常用示例</h3>
                    <div class="cron-examples-list" id="cron-examples-list">
                        <!-- 示例将由 JavaScript 动态生成 -->
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button class="btn-primary" id="close-cron-help-btn">关闭</button>
            </div>
        </div>
    </div>

    <!-- 脚本加载 -->
    <script src="/static/constants.js"></script>
    <script src="/static/utils.js"></script>
    <script src="/static/components/tabs.js"></script>
    <script src="/static/components/toolsMultiselect.js"></script>
    <script src="/static/modules/navigation.js"></script>
    <script src="/static/modules/task.js"></script>
    <script src="/static/modules/session.js"></script>
    <script src="/static/modules/history.js"></script>
    <script src="/static/modules/workingDir.js"></script>
    <script src="/static/modules/agentMonitor.js"></script>
    <script src="/static/modules/skillManager.js"></script>
    <script src="/static/modules/mcpManager.js"></script>
    <script src="/static/modules/pluginManager.js"></script>
    <script src="/static/modules/hooksManager.js"></script>
    <script src="/static/modules/claude-status/claudeStatusMain.js"></script>
    <script src="/static/modules/message-renderer/index.js"></script>
    <script src="/static/modules/scheduler.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>